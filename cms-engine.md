# Перенос сборки на наш CMS движок

Как в сборке, так и на движке весь фронтенд находится в папке `templates`. Папка `templates` на движке может содержать папки `css` и `js`, в которых могут лежать пустые стили и скрипты. Как правило, их можно безболезненно удалить.

Чтобы внедрить сборку на движок, нужно:
- перенести все содержимое из папки `templates`, кроме `BODY.tpl.php` (и, возможно, `node_modules`, т.к. могут быть проблемы с копированием на Windows);
- перенести файл `gulp-config.js` из корня;
- настроить `BODY.tpl.php`;
- создать разделы для страниц в админке;
- (возможно) перенести код из `functions.php`.

## Настройка `BODY.tpl.php`

Здесь просто нужно аккуратно перенести разметку, убедиться, что подключаются все нужные стили и скрипты (и не подключаются ненужные). А также добавить конструкцию, которая будет детектить аякс-переходы и отдавать нужную страницу.

```php
<?
if (isAjaxRequest() && defined('PAGE_JS_VIEW')) {
	displayJson([
		'body'      => $CONTENT,
		'jsview'    => PAGE_JS_VIEW,
		'title'     => \Wf\Tpl\Meta::displayTitle(),
		'sectionId' => defined('CUR_SECTION_ID') ? CUR_SECTION_ID : 0,
	]);
	exit;
}
?>
```

## Создание разделов для страниц в админке

Для каждой страницы, которые были в папке `templates/pages` (в сборке) на момент переноса, нужно в админке создать раздел с типом "HTML блок".

![Создать раздел с типом "HTML блок"](/assets/2018-04-16_17-46-06.png)

Далее зайти в созданный раздел и добавить блок.

![Добавить блока](/assets/2018-04-16_17-41-51.png)

Затем в поле "HTML" заинклюдить нужную страницу.

![Заинклюдить путь до страницы](/assets/2018-04-16_17-42-51.png)

В конце важно не забыть сохранить дамп базы со сделанными изменениями.

## Перенос кода из `functions.php`

Если во время разработки вы использовали в сборке только подключение компонент через функцию `tpl`, то больше ничего делать не нужно. Эта функция есть на движке и после создания разделов в админке проект должен завестись.

Если же вы использовали любые другие переменные и/или функции из файла `functions.php`, возможно, для корректной работы какие-то из них нужно будет перенести в файл `libs/functions/project.php` на движке.