# Frontend quick guide

В дефолтной сборке используется препроцессор LESS. 

HTML код пишется в PHP файлах. При этом PHP знать почти не обязательно - можно писать обычный HTML, - а при некотором знании можно даже использовать PHP в качестве шаблонизатора.

## Разворачивание проекта

- Скачиваем репозиторий [libs](http://hg.turbodevelopers.com/turbo/libs)
- Переходим в крайнюю ревизию ветки `altVersion-ks`
- Создаем папку для нового проекта, копируем туда все содержимое из `libs`
- В терминале переходим в папку `имя_проекта\templates` и запускаем `npm install` для установки npm модулей
- В терминале в той же папке запускаем команду `gulp` для dev-сборки проекта и запуска вотчеров

## Типовая структура проекта

Прежде, чем говорить о верстке, необходимо описать типовую струткуру проекта.

```
templates                           # Весь фронтенд проекта
    ├── build/                      # Итоговые файлы для разработки и продакшена. Здесь не нужно ничего трогать, т.к. все файлы пересобираются сборщиком автоматически.
        ├── css/                    # Итоговые css файлы (dev и min версии)
        ├── js/                     # Итоговые js файлы (dev и min версии)
        └── images/                 # Сжатые картинки и итоговые спрайты
    ├── components/                 # PHP компоненты проекта
    ├── fonts/                      # Шрифты, если шрифтов несколько, то лучше раложить их по папкам
    ├── gulp/                       # Gulp таски, сюда лезть скорее всего не придется, т.к. из коробки все что нужно уже настроено
    ├── images/                     # Картинки для проекта, лучше раскладывать их по папкам
    ├── pages/                      # PHP страницы проекта
    ├── sprites/                    # Исходники для спрайтов
        ├── png/                    # Картинки для png спрайтов
        └── svg/                    # Картинки для svg спрайтов
    ├── src/                        # Исходный код проекта
        ├── js/                     # Скрипты
            ├── BView/              # Backbone Views ("вьюхи")
                └── subView/        # "Сабвьюхи" - модули, которые могут использоваться в нескольких вьюхах
            ├── components/         # Компоненты
            ├── core/               # Базовые скрипты
            ├── libs/               # Сторонние библиотеки
            └── script.js           # Точка входа для скриптов (инициализация приложения)
        ├── less/                   # Стили
            ├── core/               # Базовые стили (normalize, шрифты, спрайты и т.п.)
            ├── common/             # Базовые модули (header, footer и т.п.)
            ├── modules/            # Все остальные модули
            ├── libs/               # Стили библиотек и плагинов
            └── styles.less         # Точка входа для стилей        
    ├── BODY.tpl.php                # Точка входа для PHP страниц
    └── gulpfile.js                 # Файл настроек gulp для сборки проекта
```

## HTML верстка

Как уже было сказано, вся верстка делается в PHP файлах, при этом PHP знать почти не обязательно - пишите обычный HTML.

Для верстки предусмотрены 2 папки: `components` и `pages`.

В `components` кладутся куски кода, которые встречаются более, чем на одной странице (хедер, футер и т.п.). Таким образом, мы пишем код всего один раз и подключаем его где хотим через директиву `include` или функцию `component()` (которая делает тот же самый `include`, но чуть удобней).

```php
<? 
// Подключение компонента
component('head'); 
?>
```

В `pages` кладутся непосредственно страницы сайта (index, news, contatcs и т.п.). Под страницей подразумевается кусок сайта между хедером и футером. Страницы могут включать в себя как компоненты, так и уникальный код.

Кроме этого, в папке templates лежит файл `BODY.tpl.php` - в нем подключаются хедер, футер и ряд других компонентов, а также находится точка входа для всех страниц сайта (переменная `<?=$CONTENT?>`). 

Таким образом, чтобы создать страницу новостей, нужно в папке `pages` создать файл `news.php`. Он автоматически подхватится точкой входа и станет доступен по адресу `имя_проекта/news`.

## Стили

Стили нужно писать модульно. Один файл должен содержать ровно ОДИН модуль (например, в `header.less` должны быть стили только для хедера). Название файла и класса по возможности должны совпадать.

Все файлы подключаются через директиву `@import` в одной точке входа - `styles.less`. Соответственно при добавлении нового файла со стилями его нужно не забыть подключить в `styles.less`.

```less
@import "modules/news";
```

В папке `core` содержаться базовые стили, которые со временем не будут меняться, либо будут меняться крайне редко. Сюда относятся: переменные, миксины, normalize/reset, подключение шрифтов, спрайтов и т.п..

В папку `libs` складываются стили библиотек и плагинов. Можно кидать сюда `css` и подключать в точке входа через `@import` с флагом `(less)`.

```less
@import (less) "libs/swiper.css";
```

В папке `common` складываются базовые стили (для тегов, врапперов, сеток и т.п.) и базовые модули проекта (header, footer).

Стили всех остальных модулей складываются в папку `modules`.

## Скрипты

Для организации кода и реализации SPA в проекте используется фреймворк Backbone. Однако совсем не обязательно знать Backbone от и до для того, чтобы начать писать свой js код. Поскольку много полезных фич, таких как, например, роутинг, уже настроены и работают из коробки.

Backbone - MVP фреймворк (Model-View-Presenter), но, как правило, в большинстве проектов не используется Model, а стало быть и Presenter. Работа идет только с View, который используется для организации модульности. Отсюда можно воспринимать View просто как модуль.
 
Во View содержится весь js, который ипользуется на странице. Таким образом, одна страница = одна вьюха. Вьюха привязывается к странице с помощью атрибута `data-view`. Например, если вы создали страницу `news.php`, то для нее необходимо создать вьюху `News.js`, а на самой странице прописать `data-view="News"`

```html
<div class="news" data-view="News"> ... </div>
```

### Структура View

```js
app.ns('app.views').News = app.core.Page.extend({

	events: {},

	initialize: function() {
		app.views.News.__super__.initialize.apply(this, arguments);
	},

	remove: function() {
		app.views.News.__super__.remove.apply(this, arguments);
	},

	render: function() {
		app.views.News.__super__.render.apply(this, arguments);
		app.views.News.__super__.afterRender.apply(this, arguments);
	}
});
```

### Работа с View

Свой код нужно писать в методе `render()`.
  
Обработчики событий нужно вешать декларативно в объекте `events`. События записываются в следующем формате `{"событие селектор": "обработчик"}`. Профит от такого подхода в том, что при уходе со страницы обработчики снимаются автоматически.

**Обратите внимание!** Backbone требует, чтобы вьюхи были привязаны к конкрерному DOM элементу. По-умолчанию таким элементом является `<div class="grid"></div>`. Поэтому если в верстке вы по какой-то причине решили изменить класс корневого элемента для вьюх, не забудьте поменять его также и в `Application.js`!

### Работа с subView

Код, который используется на нескольких страницах, нужно класть в папку `subView` и вызывать на тех страницах, где необходимо. Работа с сабвьюхами почти ничем не отличается от работы с вьюхами за исключением нескольких особенностей.

Для сабвьюх всегда нужно указывать корневой DOM элемент в свойстве `el`.

```js
app.views.MarkNewsAsRead = Backbone.View.extend({

	el: '.article',

	...
  
});
```

Вызов сабвьюхи выглядит следующим образом:

```js
this.subView['MarkNewsAsRead'] = new app.views.MarkNewsAsRead();
this.subView['MarkNewsAsRead'].render();

// или так
var MarkNewsAsRead = this.subView['MarkNewsAsRead'] = new app.views.MarkNewsAsRead();
MarkNewsAsRead.render();
```
